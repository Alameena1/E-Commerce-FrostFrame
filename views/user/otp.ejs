<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Verification</title>
    <link rel="stylesheet" type="text/css" href="/asset/user/otp.css">
</head>
<style>

</style>
<body>zzzzz
    <div class="container">
        <% if(errorMessage){ %>
            <p style="color: red;"><%= errorMessage %></p>
        <% } %>
        <form id="otpForm" action="/otp" method="post">
            <h1>Enter OTP</h1>
          

            <div class="userInput">
                <input type="text" name="otp[]" maxlength="1" oninput="jumpToNext(this, 'otp2')">
                <input type="text" name="otp[]" id="otp2" maxlength="1" oninput="jumpToNext(this, 'otp3')">
                <input type="text" name="otp[]" id="otp3" maxlength="1" oninput="jumpToNext(this, 'otp4')">
                <input type="text" name="otp[]" id="otp4" maxlength="1" oninput="jumpToNext(this, 'otp5')">
                <input type="text" name="otp[]" id="otp5" maxlength="1" oninput="jumpToNext(this, 'otp6')">
                <input type="text" name="otp[]" id="otp6" maxlength="1" oninput="jumpToNext(this, null)">
            </div> <br>          
             <div id="timerPlaceholder">Time Left: <span id="timer" style="color:red;"></span> seconds</div>

            <button type="submit">Confirm</button>
            <p class="resend text-muted mb-0 ">
                Didn't receive code? <a href="/otp" id="resendBtn" onclick="requestAgain()" class="hidden"> Request again</a>
              </p>

        </form>
    </div>

    <script>
        let timer;
        let timeLeft = 60;
        // Check if there's stored timeLeft in localStorage
        

        if(localStorage.getItem('otpTimeLeft')){
            timeLeft = parseInt(localStorage.getItem('otpTimeLeft'));
            if(timeLeft <= 0) {
                // If the timer has expired, show the Resend OTP button
                document.getElementById("timerPlaceholder").style.display = "none";
                document.getElementById("resendButton").style.display = "inline-block";
            } else {
                // If the timer is still running, start the timer
                startTimer();
            }
        }else{
            startTimer()
        }

        function startTimer() {
            timer = setInterval(() => {
                document.getElementById("timer").innerText = timeLeft;
                timeLeft--;
                // Store the timeLeft in localStorage
                localStorage.setItem('otpTimeLeft', timeLeft.toString());
                if (timeLeft < 0) {
                    clearInterval(timer);
                    document.getElementById("timerPlaceholder").style.display = "none";
                    document.getElementById("resendButton").style.display = "inline-block";
                }
            }, 1000);
        }

        function jumpToNext(input, nextInputId) {
            if (input.value.length === 1 && nextInputId) {
                document.getElementById(nextInputId).focus();
            }
        }

        function resendOTP() {
            alert("OTP Resent!");
            timeLeft = 60;
            document.getElementById("timerPlaceholder").style.display = "block";
            document.getElementById("resendButton").style.display = "none";
            // Remove stored timeLeft when OTP is resent
            localStorage.removeItem('otpTimeLeft');
            startTimer();
        }

    </script>

    
</body>
</html>
 